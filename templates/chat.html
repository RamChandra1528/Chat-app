<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</head>
<body>
    <h1>Chat Room</h1>
    <p>Welcome, {{ username }}! <a href="{{ url_for('logout') }}">Logout</a></p>
    <div id="messages"></div>
    <input id="message" placeholder="Type a message" autocomplete="off">
    <button onclick="sendMessage()">Send</button>
    <h3>Online Users</h3>
    <ul id="online-users"></ul>
    <script>
        const socket = io();
        const username = "{{ username }}";
        const room = "General";  // Hardcoded room for simplicity

        socket.emit("join", { room: room });

        socket.on("message", function(data) {
            const messages = document.getElementById("messages");
            const msg = document.createElement("p");
            msg.textContent = `${data.user}: ${data.msg}`;
            messages.appendChild(msg);
            messages.scrollTop = messages.scrollHeight;
        });

        socket.on("status_update", function(data) {
            const usersList = document.getElementById("online-users");
            let li = document.getElementById(`user-${data.username}`);
            if (!li) {
                li = document.createElement("li");
                li.id = `user-${data.username}`;
                usersList.appendChild(li);
            }
            li.textContent = `${data.username} - ${data.online ? 'Online' : 'Offline'}`;
            li.style.color = data.online ? "green" : "grey";
        });
    </script>
</body>
</html>